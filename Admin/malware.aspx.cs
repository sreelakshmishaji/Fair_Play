using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data;
using System.IO;

public partial class Admin_malware : System.Web.UI.Page
{
    Class1 cs = new Class1();
    protected void Page_Load(object sender, EventArgs e)
    {

    }

    protected void DropDownList1_SelectedIndexChanged(object sender, EventArgs e)
    {
        if(DropDownList1.SelectedValue== "Application")
        {
            //DataTable dt = cs.select("select * from AddApp a join developerreg d on a.dvid=d.dvid where a.status='Malware' and d.status!='blocked'");
            DataTable dt = cs.select("select dvid, name,count from developerreg where count>0");
            if(dt.Rows.Count>0)
            {
                GridView2.Visible = false;
                GridView1.Visible = false;
                GridView3.Visible = true;
                GridView3.DataSource = dt;
                GridView3.DataBind();
            }
        }

        if (DropDownList1.SelectedValue == "Booklet")
        {
            DataTable dt = cs.select("select * from mobilebooklet a join developerreg d on a.dvid=d.dvid where a.status='Malware'");
            if (dt.Rows.Count > 0)
            {
                GridView2.Visible = true;
                GridView3.Visible = false;
                GridView1.Visible = false;
                GridView2.DataSource = dt;
                GridView2.DataBind();
            }
        }
    }

    protected void DownloadFile(object sender, EventArgs e)
    {

        string filePath = (sender as LinkButton).CommandArgument;
        Response.ContentType = ContentType;
        //string s = Path.GetFileName(filePath);
        Response.AppendHeader("Content-Disposition", "attachment; filename=" + Path.GetFileName(filePath));
        Response.WriteFile(filePath);
        Response.End();
    }

    protected void GridView1_RowCommand(object sender, GridViewCommandEventArgs e)
    {

    }

    //protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)
    //{
    //    LinkButton btnAlert = (LinkButton)e.Row.FindControl("btnModalPopup");
    //    DataRowView drv = (DataRowView)e.Row.DataItem;
    //    string id = drv["ColumnName"].ToString();
    //    btnAlert.Attributes.Add("onclick", "sh(" + id + ");return false;");
    //}

    //protected void btnModalPopup_Click(object sender, EventArgs e)
    //{

    //}



    protected void GridView1_RowCommand1(object sender, GridViewCommandEventArgs e)
    {
        if(e.CommandName== "view1")
        {
            DataTable dt = cs.select("select * from developerreg where dvid='"+e.CommandArgument+"'");
            DataList1.DataSource = dt;
            DataList1.DataBind();
            if(dt.Rows.Count>0)
            {
                ScriptManager.RegisterStartupScript(this, GetType(), "Popup", "success();", true);
            }
          
        }
        if(e.CommandName=="view")
        {
            int a = cs.insert("update developerreg set status='blocked' where dvid='" + e.CommandArgument + "'");
            if(a>0)
            {
                ScriptManager.RegisterStartupScript(this, GetType(), "Popup", "remove();", true);
            }
        }
    }

    protected void GridView2_RowCommand(object sender, GridViewCommandEventArgs e)
    {
        if (e.CommandName == "view1")
        {
            DataTable dt = cs.select("select * from developerreg where dvid='" + e.CommandArgument + "'");
            DataList1.DataSource = dt;
            DataList1.DataBind();
            if (dt.Rows.Count > 0)
            {
                ScriptManager.RegisterStartupScript(this, GetType(), "Popup", "success();", true);
            }

        }
    }

    protected void GridView3_RowCommand(object sender, GridViewCommandEventArgs e)
    {
        if(e.CommandName== "view1")
        {
            if(GridView1.Visible==true)
            {
                GridView1.Visible = false;


            }
            else
            {
                GridView1.Visible = true;
            }

            DataTable dt = cs.select("select * from AddApp a join developerreg d on a.dvid=d.dvid where a.status='Malware' and d.status!='blocked' and d.dvid='"+e.CommandArgument+"'");
           if(dt.Rows.Count>0)
            {
               
                GridView1.DataSource = dt;
                GridView1.DataBind();
            }
        }
    }
}